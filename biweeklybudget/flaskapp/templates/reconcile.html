{% extends "base.html" %}
{% block title %}Reconcile Transactions - BiweeklyBudget{% endblock %}
{% block extra_head_css %}
    <!-- Bootstrap Datepicker CSS -->
    <link href="/static/bootstrap-datepicker/css/bootstrap-datepicker.standalone.min.css" rel="stylesheet">

    <!-- DataTables Responsive CSS -->
    <link href="/static/startbootstrap-sb-admin-2/vendor/datatables-responsive/dataTables.responsive.css" rel="stylesheet">

    {% set num_notif = notifications|length %}
    {% set notif_ht = num_notif * 72 %}
    <style>
    /*
    generated by Jinja template/view to calculate number of notifications:
    currently displaying {{ num_notif }} notification(s) ( {{ notif_ht }} pixels high )

    height of .panel-vert-scroll is based on:
      Top header is 51px
      Panel heading is 41px
      Bottom padding on the txn/OFX panel is 20px
      Bottom submit row is 86px
      Add 2px for buffer to prevent body scrolling
    ----------
    sum: 200px
    ----------
    Plus 72px for each Notification row
    Plus 72px for the status bar row (added via JS)

    this was based on bootstrap3's .pre-scrollable
    */

    .panel-vert-scroll {
      min-height: 100px;
      max-height: calc(100vh - {{ notif_ht + 200 + 72 }}px);
      overflow-y: scroll;
    }
    </style>

    <script>
        var acct_names_to_id = {};
        {% for name in accts.keys()|sort %}
        acct_names_to_id["{{ name }}"] = "{{ accts[name] }}";
        {% endfor %}
        var budget_names_to_id = {};
        {% for id in budgets.keys()|sort %}
        budget_names_to_id["{{ budgets[id] }}"] = "{{ id }}";
        {% endfor %}

        // store state for reconciled transactions - dict of Trans ID to
        // Array of [OFX account_id, OFX fitid]
        var reconciled = {};
    </script>
{% endblock %}
{% block body %}
{% include 'notifications.html' %}
            <div class="row" id="content-row">
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading"><strong>Transactions</strong></div>
                        <div class="panel-body panel-vert-scroll" id="trans-panel"></div>
                    </div>
                </div>
                <!-- /.col-lg-6 -->
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading"><strong>OFX</strong></div>
                        <div class="panel-body panel-vert-scroll" id="ofx-panel"></div>
                    </div>
                </div>
                <!-- /.col-lg-6 -->
            </div>
            <!-- /.row -->
            <div class="row" id="submit-row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <button type="button" class="btn btn-primary" id="reconcile-submit">Submit</button>
                        </div>
                    </div>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
{% include 'modal.html' %}
{% endblock %}
{% block extra_foot_script %}
    <!-- BootStrap DatePicker JS -->
    <script src="/static/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>

    <!-- DataTables JavaScript -->
    <script src="/static/startbootstrap-sb-admin-2/vendor/datatables/js/jquery.dataTables.min.js"></script>
    <script src="/static/startbootstrap-sb-admin-2/vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
    <script src="/static/startbootstrap-sb-admin-2/vendor/datatables-responsive/dataTables.responsive.js"></script>

    <!-- jQuery UI JS -->
    <script src="/static/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>

<script src="/static/js/forms.js"></script>
<script src="/static/js/transactions_modal.js"></script>
<script src="/static/js/scheduled_modal.js"></script>
<script src="/static/js/ofx.js"></script>
<script src="/static/js/reconcile.js"></script>
{% endblock %}
